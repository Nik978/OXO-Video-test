<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OXO Playlist Editor Pro</title>
  <style>
    body {
      font-family: monospace;
      background: #111;
      color: #fff;
      padding: 20px;
    }
    textarea, input {
      font-family: monospace;
      background: #222;
      color: #0f0;
      border: 1px solid #555;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background: #333;
      color: #fff;
      padding: 5px 10px;
      margin: 5px 0;
      border: none;
    }
    .day-section {
      border: 1px solid #444;
      margin: 10px 0;
      padding: 10px;
    }
  </style>
</head>
<body>

<h1>üé¨ OXO Playlist Editor Pro</h1>

<label>Aggiungi nuova data (YYYY-MM-DD):</label>
<input type="text" id="customDate" placeholder="es. 2025-06-01">
<button onclick="addCustomDate()">‚ûï Aggiungi</button>

<br><br>
<button onclick="downloadJSON()">üì¶ Esporta JSON</button>
<button onclick="generateIndex()">üõ†Ô∏è Genera index.html</button>
<input type="file" accept=".html" onchange="importSchedule(event)">
<button onclick="downloadHTML()">üíæ Salva HTML editor</button>

<div id="editor"></div>

<pre id="output"></pre>

<script>
let schedule = {
  "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {},
  "default": {}
};

const sections = ["Happy_Hour", "Standard_1", "DJ", "Standard_2"];

function renderEditor() {
  const editor = document.getElementById("editor");
  editor.innerHTML = '';
  for (const day in schedule) {
    const div = document.createElement("div");
    div.className = "day-section";
    div.innerHTML = `<h3>üìÖ ${day}</h3>`;
    sections.forEach(section => {
      const value = (schedule[day][section] || []).join(", ");
      div.innerHTML += `
        <label>${section}</label><br>
        <textarea rows="2" onchange="updateSchedule('${day}', '${section}', this.value)">${value}</textarea><br>
      `;
    });
    editor.appendChild(div);
  }
  document.getElementById("output").textContent = JSON.stringify(schedule, null, 2);
}

function updateSchedule(day, section, value) {
  const items = value.split(',').map(s => s.trim()).filter(Boolean);
  if (!schedule[day]) schedule[day] = {};
  schedule[day][section] = items;
  document.getElementById("output").textContent = JSON.stringify(schedule, null, 2);
}

function addCustomDate() {
  const date = document.getElementById("customDate").value.trim();
  if (date && !schedule[date]) {
    schedule[date] = {};
    renderEditor();
  }
}

function downloadJSON() {
  const blob = new Blob([JSON.stringify(schedule, null, 2)], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "schedule.json";
  a.click();
}

function generateIndex() {
  const indexHTML = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>OXO Scheduler</title></head><body><script>const schedule = ${JSON.stringify(schedule, null, 2)};</script></body></html>`;
  const blob = new Blob([indexHTML], { type: "text/html" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "index.html";
  a.click();
}

function importSchedule(event) {
  const reader = new FileReader();
  reader.onload = () => {
    const text = reader.result;
    try {
      const match = text.match(/schedule\s*=\s*({[\s\S]*?});/);
      if (match && match[1]) {
        schedule = JSON.parse(match[1]);
      } else {
        schedule = JSON.parse(text);
      }
      renderEditor();
    } catch (e) {
      alert("‚ùå Errore nel parsing: " + e.message);
    }
  };
  reader.readAsText(event.target.files[0]);
}

function downloadHTML() {
  const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'playlist_editor_full.html';
  a.click();
}

renderEditor();
</script>

</body>
</html>

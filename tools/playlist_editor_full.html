<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OXO Playlist Editor & Exporter</title>
  <style>
    body { font-family: monospace; background: #111; color: #eee; padding: 20px; }
    textarea, input, button {
      font-family: monospace; font-size: 14px;
      background: #222; color: #0f0; border: 1px solid #444;
      padding: 5px; margin: 5px 0; width: 100%;
    }
  </style>
</head>
<body>

<h2>üéûÔ∏è OXO Schedule Editor + Export to index.html</h2>

<input type="file" id="fileInput" accept=".html">
<button onclick="loadIndex()">üì• Importa index.html</button>
<br><br>

<textarea id="json" rows="30" placeholder="Modifica qui il JSON dello schedule..."></textarea>
<br>
<button onclick="formatJSON()">‚ú® Format</button>
<button onclick="validateJSON()">‚úÖ Validate</button>
<button onclick="downloadSchedule()">üíæ Scarica schedule.json</button>
<button onclick="exportIndex()">üöÄ Esporta nuovo index.html</button>

<pre id="output" style="white-space: pre-wrap; color: #ff8080;"></pre>

<script>
  let originalHTML = '';

  function loadIndex() {
    const input = document.getElementById('fileInput');
    const reader = new FileReader();
    reader.onload = function (e) {
      originalHTML = e.target.result;
      const match = originalHTML.match(/const schedule\s*=\s*(\{[\s\S]*?\});/);
      if (match) {
        try {
          const clean = match[1].replace(/,\s*}/g, '}');
          const obj = JSON.parse(clean);
          document.getElementById('json').value = JSON.stringify(obj, null, 2);
          output.innerText = "‚úÖ JSON importato da index.html";
        } catch (err) {
          output.innerText = "‚ùå Errore nel parsing: " + err.message;
        }
      } else {
        output.innerText = "‚ö†Ô∏è Schedule non trovato nel file.";
      }
    };
    reader.readAsText(input.files[0]);
  }

  function formatJSON() {
    try {
      const obj = JSON.parse(document.getElementById('json').value);
      document.getElementById('json').value = JSON.stringify(obj, null, 2);
      output.innerText = "‚úÖ JSON formattato.";
    } catch (e) {
      output.innerText = "‚ùå Errore nel JSON: " + e.message;
    }
  }

  function validateJSON() {
    try {
      JSON.parse(document.getElementById('json').value);
      output.innerText = "‚úÖ JSON valido.";
    } catch (e) {
      output.innerText = "‚ùå Errore nel JSON: " + e.message;
    }
  }

  function downloadSchedule() {
    const text = document.getElementById('json').value;
    const blob = new Blob([text], { type: "application/json" });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = "schedule.json";
    a.click();
  }

  function exportIndex() {
    try {
      const newJSON = document.getElementById('json').value;
      JSON.parse(newJSON); // Verifica validit√†

      const newSchedule = `const schedule = ${newJSON};`;
      const replaced = originalHTML.replace(/const schedule\s*=\s*\{[\s\S]*?\};/, newSchedule);

      const blob = new Blob([replaced], { type: "text/html" });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = "index.html";
      a.click();

      output.innerText = "‚úÖ Nuovo index.html generato!";
    } catch (e) {
      output.innerText = "‚ùå Errore: " + e.message;
    }
  }
</script>

</body>
</html>

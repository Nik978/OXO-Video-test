<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Playlist Editor</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #111; color: #eee; }
    textarea, input, select, button {
      font-family: monospace; font-size: 14px;
      background: #222; color: #0f0; border: 1px solid #444;
      padding: 5px; margin: 5px 0; width: 100%;
    }
    .section { margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; }
    .section h3 { margin: 10px 0 5px; color: #0f0; }
  </style>
</head>
<body>

<h1>üé¨ Playlist JSON Editor</h1>

<input type="file" id="fileInput" accept=".html">
<button onclick="loadFromFile()">üì• Carica da index.html</button>
<br><br>

<textarea id="json" rows="30" placeholder="Incolla qui lo schedule JSON..."></textarea><br>
<button onclick="formatJSON()">‚ú® Format</button>
<button onclick="validateJSON()">‚úÖ Validate</button>
<button onclick="download()">üíæ Download JSON</button>

<pre id="output" style="white-space: pre-wrap; color: #ff8080;"></pre>

<script>
  function loadFromFile() {
    const input = document.getElementById('fileInput');
    const reader = new FileReader();
    reader.onload = function (e) {
      const text = e.target.result;
      const match = text.match(/const schedule\s*=\s*(\{[\s\S]*?\});/);
      if (match) {
        try {
          const cleaned = match[1].replace(/,\s*}/g, '}'); // elimina virgole finali
          const parsed = JSON.parse(cleaned);
          document.getElementById('json').value = JSON.stringify(parsed, null, 2);
          document.getElementById('output').innerText = "‚úÖ Schedule caricato correttamente!";
        } catch (e) {
          document.getElementById('output').innerText = "‚ùå Errore di parsing JSON: " + e.message;
        }
      } else {
        document.getElementById('output').innerText = "‚ö†Ô∏è 'schedule' non trovato nel file.";
      }
    };
    reader.readAsText(input.files[0]);
  }

  function formatJSON() {
    try {
      const obj = JSON.parse(document.getElementById('json').value);
      document.getElementById('json').value = JSON.stringify(obj, null, 2);
      document.getElementById('output').innerText = "‚úÖ JSON formattato.";
    } catch (e) {
      document.getElementById('output').innerText = "‚ùå Errore nel JSON: " + e.message;
    }
  }

  function validateJSON() {
    try {
      JSON.parse(document.getElementById('json').value);
      document.getElementById('output').innerText = "‚úÖ JSON valido.";
    } catch (e) {
      document.getElementById('output').innerText = "‚ùå Errore: " + e.message;
    }
  }

  function download() {
    const text = document.getElementById('json').value;
    const blob = new Blob([text], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "schedule.json";
    a.click();
    URL.revokeObjectURL(url);
  }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OXO Playlist Editor Pro</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #111; color: #eee; }
    h2 { color: #4caf50; }
    input[type="text"] { width: 200px; padding: 5px; margin-bottom: 10px; }
    textarea { width: 100%; height: 60px; margin: 5px 0; }
    button { margin: 5px; padding: 8px 12px; background: #333; color: #eee; border: 1px solid #555; cursor: pointer; }
    .section { border: 1px solid #555; padding: 10px; margin-bottom: 15px; background: #222; }
    .day { margin-bottom: 25px; }
  </style>
</head>
<body>

<h1>üé¨ OXO Playlist Editor Pro</h1>

<label for="addDate">‚ûï Aggiungi nuova data (YYYY-MM-DD):</label>
<input type="text" id="addDate" placeholder="es. 2025-06-01">
<button onclick="addDate()">Aggiungi</button>

<div id="editor"></div>

<button onclick="exportSchedule()">üíæ Esporta JSON</button>
<button onclick="generateIndex()">üß© Genera index.html</button>
<input type="file" accept=".html,.json" onchange="importSchedule(event)">
<button onclick="downloadHTML()">‚¨áÔ∏è Salva HTML editor</button>

<hr>
<pre id="output" style="white-space: pre-wrap; background:#000; color:#0f0; padding: 10px;"></pre>

<script>
let schedule = {
  default: {
    Happy_Hour: [], Standard_1: [], DJ: [], Standard_2: []
  },
  1: {}, 2: {}, 3: {}, 4: {}, 5: {}, 6: {}, 7: {}
};

const sections = ["Happy_Hour", "Standard_1", "DJ", "Standard_2"];

function renderEditor() {
  const container = document.getElementById('editor');
  container.innerHTML = '';
  for (const day in schedule) {
    const dayDiv = document.createElement('div');
    dayDiv.className = 'day';
    dayDiv.innerHTML = `<h2>üìÖ Giorno: ${day}</h2>`;
    sections.forEach(section => {
      const val = (schedule[day][section] || []).join(', ');
      dayDiv.innerHTML += `
        <div class="section">
          <strong>üîπ ${section}</strong><br>
          <textarea oninput="updateSchedule('${day}', '${section}', this.value)">${val}</textarea>
        </div>`;
    });
    container.appendChild(dayDiv);
  }
}

function updateSchedule(day, section, value) {
  schedule[day][section] = value.split(',').map(s => s.trim()).filter(Boolean);
}

function addDate() {
  const date = document.getElementById('addDate').value.trim();
  if (date && !schedule[date]) {
    schedule[date] = { Happy_Hour: [], Standard_1: [], DJ: [], Standard_2: [] };
    renderEditor();
  }
}

function exportSchedule() {
  const out = JSON.stringify(schedule, null, 2);
  document.getElementById('output').textContent = out;
}

function generateIndex() {
  const json = JSON.stringify(schedule, null, 2);
  const indexHTML = `
<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>OXO Scheduler</title></head>
<body>
<script>
const schedule = ${json};
</script>
</body>
</html>`;
  document.getElementById('output').textContent = indexHTML.trim();
}

function importSchedule(event) {
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const text = reader.result;
      if (text.includes("const schedule =")) {
        const match = text.match(/const schedule\s*=\s*({[\s\S]*?})\s*;/);
        if (match) schedule = JSON.parse(match[1]);
      } else {
        schedule = JSON.parse(text);
      }
      renderEditor();
    } catch (e) {
      alert("‚ùå Errore nel parsing: " + e.message);
    }
  };
  reader.readAsText(event.target.files[0]);
}

function downloadHTML() {
  const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'playlist_editor_pro.html';
  a.click();
}

renderEditor();
</script>

</body>
</html>

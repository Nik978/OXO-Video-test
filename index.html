<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>OXO Scheduler - Video Smart Player</title>
  <style>
    body {
      margin: 0;
      background: black;
    }
    video {
      width: 100vw;
      height: 100vh;
      object-fit: cover;
    }
    #debug {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <video id="player" autoplay muted playsinline></video>
  <div id="debug"></div>

  <script>
    const videoEl = document.getElementById("player");
    const debug = document.getElementById("debug");

    const GitHubBase = "https://nik978.github.io/OXO-Video-test/";
    const LocalBase = "./"; // usa la stessa cartella
    const DRIVE_ID_MAP = {
      "Bucket": "1w-EppmvRfZYQWD8IfXIA0fLSxKX-Va2B",
      "Cosplay": "16lgmUBoaeZvUwWsIpkk2KA97v3hoGPwa",
      "Football": "1cimWj6bOx24MOnKaLqZRTyfwejRSOphe",
      "Happy": "1Z8HXqG4lLe_gsxFwmOdV0ZOUuYVrbhOb",
      "Intro": "1F6UHL045U4MUEun-oMNEmQ919Fj4m_F1",
      "Recruit": "1QC__zznW1Urz6j1oXy28SjVGN6NvaUGw"
    };

    const MODE = "auto"; // pu√≤ essere: "github", "local", "drive", "auto"

    function getNowInfo() {
      const now = new Date();
      const rawDay = now.getDay();
      const hour = now.getHours();
      const minute = now.getMinutes();
      const minutes = hour * 60 + minute;

      const day = minutes < 660 ? (rawDay + 6) % 7 : rawDay; // giorno commerciale (dalle 11 alle 10:59)

      return { now, rawDay, day, hour, minute, minutes };
    }

    function getFasciaLabel(minutes) {
      if (minutes >= 1110 && minutes < 1260) return "Fascia 1 (18:30‚Äì21:00)";
      if (minutes >= 1260 || minutes < 120) return "Fascia 2A (21:00‚Äì02:00)";
      if (minutes >= 120 && minutes < 240) return "Fascia 2B (02:00‚Äì04:00)";
      return "Fuori fascia";
    }

    const playlistMap = {
      "Sun": {
        pre: ["Happy", "Football", "Happy", "Bucket"],
        post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
      },
      "Mon": {
        pre: ["Happy", "Football", "Happy", "Bucket"],
        post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
      },
      "Tue": {
        pre: ["Happy", "Football", "Happy", "Bucket"],
        post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
      },
      "Wed": {
        pre: ["Happy", "Football", "Happy", "Bucket"],
        post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
      },
      "Thu": {
        pre: ["Bucket", "Football", "Bucket", "Happy", "Bucket"],
        post: ["Intro", "Bucket", "Football", "Bucket", "Happy", "Bucket", "Cosplay", "Bucket", "Recruit"]
      },
      "Fri": {
        pre: ["Happy", "Football", "Happy", "Bucket"],
        post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
      },
      "Sat": {
        pre: ["Happy", "Football", "Happy", "Football"],
        post: ["Football"] // con o senza countdown
      }
    };

    function getVideoURL(name) {
      if (MODE === "github") return GitHubBase + name + ".mp4";
      if (MODE === "local") return LocalBase + name + ".mp4";
      if (MODE === "drive") return `https://drive.google.com/uc?export=download&id=${DRIVE_ID_MAP[name]}`;

      if (location.href.startsWith("file://") || location.href.includes("localhost")) {
        return LocalBase + name + ".mp4";
      } else if (location.href.includes("github.io")) {
        return GitHubBase + name + ".mp4";
      } else {
        return `https://drive.google.com/uc?export=download&id=${DRIVE_ID_MAP[name]}`;
      }
    }

    function getPlaylistName() {
      const { day, minutes } = getNowInfo();
      const dayLabel = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"][day];

      if (minutes >= 1110 && minutes < 1260) return playlistMap[dayLabel].pre;
      return playlistMap[dayLabel].post;
    }

    function showDebug(videoName) {
      const { hour, minute, day, minutes } = getNowInfo();
      const h = String(hour).padStart(2, '0');
      const m = String(minute).padStart(2, '0');
      const dayLabel = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"][day];
      const fascia = getFasciaLabel(minutes);
      const src = videoEl.src.includes("github.io") ? "GitHub" :
                  videoEl.src.includes("googleusercontent") ? "Drive" :
                  videoEl.src.includes("localhost") ? "Localhost" :
                  videoEl.src.includes("file://") ? "Locale" : "Altro";

      debug.innerHTML = `
        üïí Time: ${h}:${m}<br>
        üìÜ Day: ${day} (${dayLabel}=0)<br>
        üéØ Fascia: ${fascia}<br>
        üìÇ Playlist: ${videoName}<br>
        üåç Sorgente: ${src}
      `;
    }

    let playlist = getPlaylistName();
    let current = 0;

    function playNext() {
      const name = playlist[current % playlist.length];
      videoEl.src = getVideoURL(name);
      videoEl.play();
      showDebug(name);
      current++;
    }

    videoEl.onended = playNext;
    playNext();
  </script>
</body>
</html>

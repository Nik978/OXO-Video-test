<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OXO Scheduler</title>
  <style>
    body {
      margin: 0;
      background-color: black;
    }
    video {
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      display: block;
    }
    #logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 60%;
      max-height: 60%;
      display: none;
    }
    #countdown {
      position: absolute;
      top: 10px;
      right: 10px;
      color: yellow;
      font-size: 2em;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px;
      font-family: monospace;
      display: none;
    }
    #debug {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <video id="player" autoplay muted playsinline></video>
  <img id="logo" src="" alt="Logo" />
  <div id="countdown"></div>
  <div id="debug"></div>

  <script>
    const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const folder = isMobile ? "Mobile" : "TV";
    const versione = "2025.05.full";

    const videoMap = {
      "Bucket": `${folder}/Bucket.mp4`,
      "Cosplay": `${folder}/Cosplay.mp4`,
      "Football": `${folder}/Football.mp4`,
      "Happy": `${folder}/Happy.mp4`,
      "Intro": `${folder}/Intro.mp4`,
      "Recruit": `${folder}/Recruit.mp4`,
      "Promo": `${folder}/Promo.mp4`
    };

    const logoUrl = `${folder}/logo.png`;

    const scheduleData = {
      "default": {
        "Standard_1": ["Intro.mp4"],
        "DJ": ["Football.mp4", "Promo.mp4"],
        "Standard_2": ["Recruit.mp4", "Bucket.mp4"]
      },
      "4": {
        "Standard_1": ["Bucket.mp4"],
        "DJ": ["Bucket.mp4", "Football.mp4"],
        "Standard_2": ["Recruit.mp4", "Bucket.mp4"]
      },
      "6": {
        "Standard_1": ["Cosplay.mp4"],
        "DJ": ["Football.mp4", "Cosplay.mp4"],
        "Standard_2": ["Cosplay.mp4", "Recruit.mp4"]
      }
    };

    const video = document.getElementById("player");
    const logo = document.getElementById("logo");
    const countdownBox = document.getElementById("countdown");
    const debugDiv = document.getElementById("debug");

    let playlist = [];
    let current = 0;
    let countdownTimer = null;

    function getCurrentDay() {
      const now = new Date();
      const h = now.getHours();
      return (h < 5) ? (now.getDay() === 0 ? 7 : now.getDay()) : now.getDay();
    }

    function getSection(min) {
      if (min >= 1140 && min < 1260) return "Happy_Hour";       // 19:00‚Äì21:00
      if (min >= 1260 && min < 1320) return "Standard_1";       // 21:00‚Äì22:00
      if (min >= 1320 || min < 120) return "DJ";                // 22:00‚Äì02:00
      if (min >= 120 && min < 300) return "Standard_2";         // 02:00‚Äì05:00
      return "Closed";                                          // 05:00‚Äì19:00
    }

    function getPlaylist() {
      const now = new Date();
      const minutes = now.getHours() * 60 + now.getMinutes();
      const section = getSection(minutes);
      const day = getCurrentDay().toString();
      const config = scheduleData[day] || scheduleData["default"];
      return {
        list: config[section] || [],
        sectionName: section
      };
    }

    function updateDebug(fascia, videoName) {
      const now = new Date();
      const h = String(now.getHours()).padStart(2, "0");
      const m = String(now.getMinutes()).padStart(2, "0");
      const s = String(now.getSeconds()).padStart(2, "0");
      const d = getCurrentDay();
      debugDiv.innerHTML = `
        üïí Time: ${h}:${m}:${s}<br>
        üìÜ Day: ${d}<br>
        üéØ Section: ${fascia}<br>
        ‚ñ∂Ô∏è Video: ${videoName}<br>
        üîÅ Version: ${versione}
      `;
    }

    function isHappyCountdownActive() {
      const now = new Date();
      const min = now.getHours() * 60 + now.getMinutes();
      return min >= 1140 && min < 1260; // 19:00‚Äì21:00
    }

    function updateCountdown() {
      const now = new Date();
      const target = new Date();
      target.setHours(21, 0, 0, 0);
      if (target < now) target.setDate(target.getDate() + 1);
      const diff = target - now;
      if (diff <= 0) {
        countdownBox.style.display = "none";
        clearInterval(countdownTimer);
        return;
      }
      const h = Math.floor(diff / 3.6e6);
      const m = Math.floor((diff % 3.6e6) / 6e4);
      const s = Math.floor((diff % 6e4) / 1e3);
      countdownBox.innerText = `Countdown: ${h}h ${m}m ${s}s`;
    }

    function playNext() {
      const now = new Date();
      const totalMin = now.getHours() * 60 + now.getMinutes();
      const isActive = totalMin >= 1080 || totalMin < 300; // 18:00‚Äì05:00

      if (!isActive) {
        logo.src = logoUrl;
        logo.style.display = "block";
        video.pause();
        video.style.display = "none";
        updateDebug("Spento (05:00‚Äì18:00)", "-");
        return;
      }

      logo.style.display = "none";
      video.style.display = "block";

      if (playlist.length === 0 || current >= playlist.length) {
        const res = getPlaylist();
        playlist = res.list;
        current = 0;
      }

      const name = playlist[current % playlist.length];
      const src = videoMap[name.replace(".mp4", "")] || `${folder}/${name}`;
      video.src = src;
      video.play();
      updateDebug(getSection(totalMin), name);
      current++;

      if (name === "Happy.mp4" && isHappyCountdownActive()) {
        countdownBox.style.display = "block";
        updateCountdown();
        countdownTimer = setInterval(updateCountdown, 1000);
      } else {
        countdownBox.style.display = "none";
        clearInterval(countdownTimer);
      }
    }

    video.onended = playNext;
    playNext();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OXO Smart Video Scheduler</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    video { width: 100vw; height: 100vh; object-fit: cover; display: none; }
    #logo { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            max-width: 80vw; max-height: 80vh; display: none; }
    #countdown { position: absolute; top: 10px; right: 10px; color: yellow; font-size: 2em;
                 background: rgba(0,0,0,0.6); padding: 10px; font-family: monospace;
                 display: none; z-index: 1000; }
    #debug { position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: #0f0;
             padding: 10px; font-family: monospace; font-size: 12px; z-index: 9999; }
  </style>
</head>
<body>
  <video id="player" autoplay muted playsinline></video>
  <img id="logo" src="" alt="OXO Logo">
  <div id="countdown"></div>
  <div id="debug"></div>

  <script>
    const isMobile = /Android|iPhone/i.test(navigator.userAgent);
    const version = isMobile ? "Mobile" : "TV";
    const basePath = `https://nik978.github.io/OXO-Video-test/${version}/`;
    const logoUrl = basePath + "logo.png";

    const weekdayMap = {
      1: "Monday", 2: "Tuesday", 3: "Wednesday", 4: "Thursday",
      5: "Friday", 6: "Saturday", 7: "Sunday"
    };

    // üé¨ PLAYLIST PER GIORNO (COMMERCIALE) E SEZIONE ORARIA
    // - Modifica o aggiungi qui i file video per ogni sezione (Evening_Block_1, _2, Late_Block)
    // - Chiave 'default' = tutti i giorni tranne quelli specificati
    // - Chiave '4' = Gioved√¨ (evento Buckets), '6' = Sabato (evento Cosplay)
    const playlists = {
      "default": {
        "Evening_Block_1": ["Intro.mp4"],
        "Evening_Block_2": ["Football.mp4", "Promo.mp4"],
        "Late_Block": ["Recruit.mp4", "Bucket.mp4"]
      },
      "4": {
        "Evening_Block_1": ["Bucket.mp4"],
        "Evening_Block_2": ["Bucket.mp4", "Football.mp4"],
        "Late_Block": ["Recruit.mp4", "Bucket.mp4"]
      },
      "6": {
        "Evening_Block_1": ["Cosplay.mp4"],
        "Evening_Block_2": ["Football.mp4", "Cosplay.mp4"],
        "Late_Block": ["Cosplay.mp4", "Recruit.mp4"]
      }
    };

    const video = document.getElementById("player");
    const logo = document.getElementById("logo");
    const countdownBox = document.getElementById("countdown");
    const debugDiv = document.getElementById("debug");
    let current = 0;
    let countdownTimer;

    // üìÖ CALCOLO DEL GIORNO COMMERCIALE
    // - La giornata inizia alle 05:00 e finisce alle 04:59 del giorno dopo
    function getDayNumberCommercial() {
      const now = new Date();
      now.setHours(now.getHours() - 5);
      const d = now.getDay();
      return d === 0 ? 7 : d;
    }

    // ‚è∞ SEZIONE ORARIA
    // - Determina la fascia oraria attiva in base ai minuti trascorsi da mezzanotte
    // - Fasce fisse: Happy Hour, Evening Blocks, Late, Closed
    function getSection(min) {
      if (min >= 1140 && min < 1260) return "Happy_Hour";
      if (min >= 1110 && min < 1140) return "Evening_Block_1";
      if (min >= 1260 || min < 120) return "Evening_Block_2";
      if (min >= 120 && min < 300) return "Late_Block";
      return "Closed";
    }

    function isCountdownActive(min) {
      return min >= 1140 && min < 1260;
    }

    function updateCountdown() {
      const now = new Date();
      const target = new Date();
      target.setHours(21, 0, 0, 0);
      if (target < now) target.setDate(target.getDate() + 1);
      const diff = target - now;

      if (diff <= 0) {
        countdownBox.style.display = "none";
        clearInterval(countdownTimer);
        return;
      }

      const h = Math.floor(diff / 3.6e6);
      const m = Math.floor((diff % 3.6e6) / 6e4);
      const s = Math.floor((diff % 6e4) / 1e3);
      countdownBox.innerText = `Countdown: ${h}h ${m}m ${s}s`;
    }

    // üß™ DEBUG VISIVO
    // - Mostra info sullo schermo in basso a sinistra
    function updateDebug(day, section, name) {
      const now = new Date();
      const h = String(now.getHours()).padStart(2, "0");
      const m = String(now.getMinutes()).padStart(2, "0");
      const s = String(now.getSeconds()).padStart(2, "0");

      debugDiv.innerHTML = `
        üïí Time: ${h}:${m}:${s}<br>
        üìÜ Day: ${weekdayMap[day]} (${day})<br>
        üîÅ Section: ${section}<br>
        üéûÔ∏è Now Playing: ${name}<br>
        üì± Version: ${version}
      `;
    }

    function playNext() {
      const now = new Date();
      const minutes = now.getHours() * 60 + now.getMinutes();
      const section = getSection(minutes);
      const day = getDayNumberCommercial();

      if (section === "Closed") {
        video.style.display = "none";
        video.pause();
        logo.style.display = "block";
        logo.src = logoUrl;
        updateDebug(day, section, "-");
        return;
      }

      // üéûÔ∏è GESTIONE RIPRODUZIONE
      // - 'Happy.mp4' √® fisso durante la Happy_Hour
      // - In altri orari viene selezionato in base alla sezione e al giorno
      let name = "Happy.mp4";
      if (section !== "Happy_Hour") {
        const todayPlaylist = playlists[day] || playlists["default"];
        const list = todayPlaylist[section] || [];
        name = list[current % list.length];
      }

      const src = basePath + name;
      video.src = src;
      video.style.display = "block";
      logo.style.display = "none";
      video.play();

      updateDebug(day, section, name);

      if (section === "Happy_Hour" && isCountdownActive(minutes)) {
        countdownBox.style.display = "block";
        updateCountdown();
        countdownTimer = setInterval(updateCountdown, 1000);
      } else {
        countdownBox.style.display = "none";
        clearInterval(countdownTimer);
      }

      current++;
    }

    video.onended = playNext;
    playNext();
  </script>
</body>
</html>

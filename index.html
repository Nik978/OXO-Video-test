<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>OXO Scheduler</title>
  <style>
    body {
      margin: 0;
      background: black;
    }
    video, iframe {
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      display: block;
    }
    #debug {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      z-index: 9999;
    }
  </style>
</head>
<body>

<video id="player" autoplay muted playsinline></video>
<div id="debug"></div>

<script>
const debug = document.getElementById("debug");
const videoEl = document.getElementById("player");

const DRIVE_ID_MAP = {
  "Intro":    "1F6UHL045U4MUEun-oMNEmQ919Fj4mF1",
  "Football": "1cimWj6bOx24MOnKaLqZRTyfwejRSOphe",
  "Bucket":   "1w-EppmvRfZYQWD8IfXIA0fLSxKX-Va2B",
  "Happy":    "1Z8HXqG4lLe_gsxFwmOdV0ZOUuYVrbhOb",
  "Cosplay":  "16lgmUBoaeZvUwWsIpkk2KA97v3hoGPwa",
  "Recruit":  "1QC__zznW1Urz6j1oXy28SjVGN6NvaUGw"
};

const GitHubBase = "https://nik978.github.io/OXO-Video-test/";
const LocalBase = "http://127.0.0.1:8080/Download/Kiosk/";

// ðŸ‘‡ modifica qui per cambiare sorgente
const MODE = "auto";  // "github" | "drive" | "local" | "auto"

function getPlatform() {
  const w = screen.width;
  const ua = navigator.userAgent;
  return (w <= 768 || /Android|iPhone|Mobile/.test(ua)) ? "Mobile" : "TV";
}

function getNowInfo() {
  const now = new Date();
  let hour = now.getHours(), minute = now.getMinutes();
  let realDay = now.getDay(); // 0 = Sunday
  if (hour < 11) realDay = (realDay + 6) % 7; // Commercial day starts at 11:00
  const minutes = hour * 60 + minute;
  return { hour, minute, minutes, day: realDay, now };
}

function getFasciaLabel(m) {
  if (m >= 1110 && m < 1260) return "Fascia 1 (18:30â€“21:00)";
  if (m >= 1260 && m < 1440) return "Fascia 2A (21:00â€“24:00)";
  if (m >= 0 && m < 120)    return "Fascia 2B (00:00â€“02:00)";
  if (m >= 120 && m < 240)  return "Fascia 2C (02:00â€“04:00)";
  return "Fuori fascia";
}

function getPlaylist(day, m) {
  if (m >= 1110 && m < 1260) {
    return (day === 6)
      ? ["Happy", "Football", "Happy", "Football"]
      : ["Happy", "Football", "Happy", "Bucket"];
  } else if (m >= 1260 && m < 1440) {
    return (day === 6) ? ["Football", "Sabato Countdown"] : 
                        ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"];
  } else if (m >= 0 && m < 120) {
    return (day === 6) ? ["Football"] : 
                        ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"];
  } else if (m >= 120 && m < 240) {
    return ["Football"];
  } else {
    return ["Intro"];
  }
}

function getVideoURL(name) {
  if (MODE === "github") return GitHubBase + name + ".mp4";
  if (MODE === "local") return LocalBase + name + ".mp4";
  if (MODE === "drive") return `https://drive.google.com/uc?export=download&id=${DRIVE_ID_MAP[name]}`;

  // AUTO: try local â†’ github â†’ drive
  if (location.href.startsWith("file://") || location.href.includes("127.0.0.1") || location.href.includes("localhost")) {
    return LocalBase + name + ".mp4";
  } else if (location.href.includes("github.io")) {
    return GitHubBase + name + ".mp4";
  } else {
    return `https://drive.google.com/uc?export=download&id=${DRIVE_ID_MAP[name]}`;
  }
}

function playVideos(playlist, version) {
  let i = 0;

  function playNext() {
    const videoName = playlist[i % playlist.length];
    const url = getVideoURL(videoName);
    videoEl.src = url;
    videoEl.play();
    showDebug(videoName, version);
    i++;
  }

  videoEl.onended = playNext;
  playNext();
}

function showDebug(videoName, version) {
  const { hour, minute, now, day, minutes } = getNowInfo();
  const dayLabel = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"][day];
  const fascia = getFasciaLabel(minutes);

  debug.innerHTML = `
    ðŸ•’ Time: ${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}<br>
    ðŸ“† Day: ${day} (${dayLabel}=0)<br>
    ðŸŽ¯ Fascia: ${fascia}<br>
    ðŸ“‚ Playlist: ${videoName}<br>
    ðŸ“± Versione: ${version}
  `;
}

// Init
const { day, minutes } = getNowInfo();
const version = getPlatform();
const playlist = getPlaylist(day, minutes);
playVideos(playlist, version);
</script>

</body>
</html>

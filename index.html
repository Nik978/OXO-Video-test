<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>OXO Scheduler - Dual Version</title>
  <style>
    body {
      margin: 0;
      background: black;
    }
    video {
      width: 100vw;
      height: 100vh;
      object-fit: cover;
    }
    #countdown {
      position: absolute;
      top: 10px;
      right: 10px;
      color: yellow;
      font-size: 2em;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px;
      font-family: monospace;
    }
    #debug {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      z-index: 9999;
    }
  </style>
</head>
<body>

<video id="player" autoplay muted playsinline></video>
<div id="countdown" style="display: none;"></div>
<div id="debug"></div>

<script>
  // 📁 Rileva se usare versione TV o Mobile
  const isMobile = /Mobi|Android/i.test(navigator.userAgent);
  const basePath = isMobile ? "Mobile/" : "TV/";

  const videoMap = {
    "Bucket": `https://nik978.github.io/OXO-Video-test/${basePath}Bucket.mp4`,
    "Cosplay": `https://nik978.github.io/OXO-Video-test/${basePath}Cosplay.mp4`,
    "Football": `https://nik978.github.io/OXO-Video-test/${basePath}Football.mp4`,
    "Happy": `https://nik978.github.io/OXO-Video-test/${basePath}Happy.mp4`,
    "Intro": `https://nik978.github.io/OXO-Video-test/${basePath}Intro.mp4`,
    "Recruit": `https://nik978.github.io/OXO-Video-test/${basePath}Recruit.mp4`,
  };

  const playlistMap = {
    "Sun": {
      pre: ["Happy", "Football", "Happy", "Bucket"],
      post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
    },
    "Mon": {
      pre: ["Happy", "Football", "Happy", "Bucket"],
      post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
    },
    "Tue": {
      pre: ["Happy", "Football", "Happy", "Bucket"],
      post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
    },
    "Wed": {
      pre: ["Happy", "Football", "Happy", "Bucket"],
      post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
    },
    "Thu": {
      pre: ["Bucket", "Football", "Bucket", "Happy", "Bucket"],
      post: ["Intro", "Bucket", "Football", "Bucket", "Happy", "Bucket", "Cosplay", "Bucket", "Recruit"]
    },
    "Fri": {
      pre: ["Happy", "Football", "Happy", "Bucket"],
      post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
    },
    "Sat": {
      pre: ["Happy", "Football", "Happy", "Football"],
      post: ["Football"]  // + Countdown fino alle 02:00
    }
  };

  const video = document.getElementById("player");
  const countdownBox = document.getElementById("countdown");
  const debugDiv = document.getElementById("debug");

  function getPlaylist() {
    const now = new Date();
    const day = now.toString().slice(0, 3);
    const hour = now.getHours();
    const min = now.getMinutes();
    const minutes = hour * 60 + min;

    if (minutes >= 1110 && minutes < 1260) return { list: playlistMap[day].pre, fascia: "Fascia 1 (18:30–21:00)" };
    else return { list: playlistMap[day].post, fascia: "Fascia 2 (21:00–04:00)" };
  }

  function handleCountdown() {
    const now = new Date();
    const isSaturday = now.getDay() === 6;
    const totalMin = now.getHours() * 60 + now.getMinutes();

    if (isSaturday && totalMin >= 1260 && totalMin < 1440) {
      countdownBox.style.display = "block";
      setInterval(() => {
        const now = new Date();
        const target = new Date();
        target.setHours(2, 0, 0, 0);
        if (target < now) target.setDate(target.getDate() + 1);
        const diff = target - now;
        if (diff <= 0) {
          countdownBox.innerText = "MATCH INIZIATO!";
          return;
        }
        const h = Math.floor(diff / 3.6e6);
        const m = Math.floor((diff % 3.6e6) / 6e4);
        const s = Math.floor((diff % 6e4) / 1e3);
        countdownBox.innerText = "Match tra " + h + "h " + m + "m " + s + "s";
      }, 1000);
    }
  }

  function updateDebug(fasciaLabel, videoName) {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const s = String(now.getSeconds()).padStart(2, '0');
    const d = now.getDay();

    debugDiv.innerHTML = `
      🕒 Time: ${h}:${m}:${s}<br>
      📆 Day: ${d} (Sun=0)<br>
      🎯 Fascia: ${fasciaLabel}<br>
      📂 Playlist: ${videoName}<br>
      🖥️ Versione: ${isMobile ? "Mobile" : "TV"}
    `;
  }

  const { list: playlist, fascia } = getPlaylist();
  let current = 0;

  function playNext() {
    const name = playlist[current % playlist.length];
    video.src = videoMap[name];
    video.play();
    updateDebug(fascia, name);
    current++;
  }

  video.onended = playNext;
  handleCountdown();
  playNext();
</script>

</body>
</html>

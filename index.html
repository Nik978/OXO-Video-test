<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>OXO Scheduler</title>
  <style>
    body {
      margin: 0;
      background: black;
    }
    video {
      width: 100vw;
      height: 100vh;
      object-fit: cover;
    }
    #debug {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <video id="player" autoplay muted playsinline></video>
  <div id="debug"></div>

  <script>
    const isMobile = /Mobi|Android/i.test(navigator.userAgent);
    const basePath = isMobile
      ? "https://nik978.github.io/OXO-Video-test/Mobile/"
      : "https://nik978.github.io/OXO-Video-test/TV/";

    const videoMap = {
      "Bucket": basePath + "Bucket.mp4",
      "Cosplay": basePath + "Cosplay.mp4",
      "Football": basePath + "Football.mp4",
      "Happy": basePath + "Happy.mp4",
      "Intro": basePath + "Intro.mp4",
      "Recruit": basePath + "Recruit.mp4",
    };

    const playlistMap = {
      "Sun": { pre: ["Happy", "Football", "Happy", "Bucket"], post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"] },
      "Mon": { pre: ["Happy", "Football", "Happy", "Bucket"], post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"] },
      "Tue": { pre: ["Happy", "Football", "Happy", "Bucket"], post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"] },
      "Wed": { pre: ["Happy", "Football", "Happy", "Bucket"], post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"] },
      "Thu": { pre: ["Bucket", "Football", "Bucket", "Happy", "Bucket"], post: ["Intro", "Bucket", "Football", "Bucket", "Happy", "Bucket", "Cosplay", "Bucket", "Recruit"] },
      "Fri": { pre: ["Happy", "Football", "Happy", "Bucket"], post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"] },
      "Sat": {
        pre: ["Happy", "Football", "Happy", "Football"],
        post: function () {
          const now = new Date();
          const min = now.getHours() * 60 + now.getMinutes();
          if (min < 120) {
            return ["Football", "Sabato Countdown.mp4"];
          } else {
            return ["Football"];
          }
        }
      }
    };

    const video = document.getElementById("player");
    const debugDiv = document.getElementById("debug");

    function getPlaylist() {
      const now = new Date();
      const dayName = now.toString().slice(0, 3);
      const hour = now.getHours();
      const min = now.getMinutes();
      const minutes = hour * 60 + min;
      const commercialDay = now.getDay(); // logico ma flessibile

      const fascia = (minutes >= 1110 || minutes < 660) ? "pre" : "post"; // 18:30â€“11:00
      const isSat = commercialDay === 6;
      let list = playlistMap[dayName][fascia];
      if (typeof list === "function") list = list();
      return { list, fascia, day: dayName, type: isMobile ? "Mobile" : "TV" };
    }

    let state = getPlaylist();
    let current = 0;

    function updateDebug(name) {
      const now = new Date();
      debugDiv.innerHTML =
        `ðŸ•’ Time: ${now.toLocaleTimeString()}<br>` +
        `ðŸ“† Day: ${state.day}<br>` +
        `ðŸŽ¯ Fascia: ${state.fascia}<br>` +
        `ðŸ“‚ Playlist: ${name}<br>` +
        `ðŸ§­ Versione: ${state.type}`;
    }

    function playNext() {
      const name = state.list[current % state.list.length];
      video.src = videoMap[name] || "";
      video.play();
      updateDebug(name);
      current++;
    }

    video.onended = playNext;
    playNext();
  </script>
</body>
</html>

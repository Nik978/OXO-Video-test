
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OXO Scheduler - JSON Powered</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    video { width: 100vw; height: 100vh; object-fit: cover; display: none; }
    #logo { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            max-width: 80vw; max-height: 80vh; display: none; }
    #countdown { position: absolute; top: 10px; right: 10px; color: yellow; font-size: 2em;
                 background: rgba(0,0,0,0.6); padding: 10px; font-family: monospace;
                 display: none; z-index: 1000; }
    #debug { position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: #0f0;
             padding: 10px; font-family: monospace; font-size: 12px; z-index: 9999; }
  </style>
</head>
<body>
  <video id="player" autoplay muted playsinline></video>
  <img id="logo" src="" alt="OXO Logo">
  <div id="countdown"></div>
  <div id="debug"></div>

  <script>
    const isMobile = /Android|iPhone/i.test(navigator.userAgent);
    const version = isMobile ? "Mobile" : "TV";
    const basePath = `https://nik978.github.io/OXO-Video-test/${version}/`;
    const logoUrl = basePath + "logo.png";

    const video = document.getElementById("player");
    const logo = document.getElementById("logo");
    const countdownBox = document.getElementById("countdown");
    const debugDiv = document.getElementById("debug");
    let current = 0;
    let countdownTimer = null;
    let playlistData = {};

    function getDayNumberCommercial() {
      const now = new Date();
      now.setHours(now.getHours() - 5);
      const d = now.getDay();
      return d === 0 ? 7 : d;
    }

    function getSection(min) {
      if (min < 1110) return "Closed";             // 05:00‚Äì18:30
      if (min >= 1110 && min < 1140) return "Standard_1"; // 18:30‚Äì19:00
      if (min >= 1140 && min < 1260) return "Happy_Hour"; // 19:00‚Äì21:00
      if (min >= 1260 || min < 120) return "DJ";         // 21:00‚Äì02:00
      if (min >= 120 && min < 300) return "Standard_2";  // 02:00‚Äì05:00
      return "Closed";
    }

    function isCountdownActive(min) {
      return min >= 1140 && min < 1260;
    }

    function updateCountdown() {
      const now = new Date();
      const target = new Date();
      target.setHours(21, 0, 0, 0);
      if (target < now) target.setDate(target.getDate() + 1);
      const diff = target - now;

      if (diff <= 0) {
        countdownBox.style.display = "none";
        clearInterval(countdownTimer);
        return;
      }

      const h = Math.floor(diff / 3.6e6);
      const m = Math.floor((diff % 3.6e6) / 6e4);
      const s = Math.floor((diff % 6e4) / 1e3);
      countdownBox.innerText = `Countdown: ${h}h ${m}m ${s}s`;
    }

    function updateDebug(day, section, name) {
      const now = new Date();
      const h = String(now.getHours()).padStart(2, "0");
      const m = String(now.getMinutes()).padStart(2, "0");
      const s = String(now.getSeconds()).padStart(2, "0");

      debugDiv.innerHTML = `
        üïí Time: ${h}:${m}:${s}<br>
        üìÜ Day: ${day}<br>
        üîÅ Section: ${section}<br>
        üéûÔ∏è Now Playing: ${name}<br>
        üì± Version: ${version}
      `;
    }

    function playNext() {
      const now = new Date();
      const minutes = now.getHours() * 60 + now.getMinutes();
      const section = getSection(minutes);
      const day = getDayNumberCommercial();

      if (section === "Closed") {
        video.style.display = "none";
        video.pause();
        logo.style.display = "block";
        logo.src = logoUrl;
        updateDebug(day, section, "-");
        return;
      }

      const sourceDay = playlistData[day] || playlistData["default"] || {};
      const list = sourceDay[section] || [];
      const name = section === "Happy_Hour" ? "Happy.mp4" : list[current % list.length];
      const src = basePath + name;

      video.src = src;
      video.style.display = "block";
      logo.style.display = "none";
      video.play();
      updateDebug(day, section, name);

      if (section === "Happy_Hour" && isCountdownActive(minutes)) {
        countdownBox.style.display = "block";
        updateCountdown();
        countdownTimer = setInterval(updateCountdown, 1000);
      } else {
        countdownBox.style.display = "none";
        clearInterval(countdownTimer);
      }

      current++;
    }

    video.onended = playNext;

    // Fetch the JSON file
    fetch("schedule.json")
      .then(res => res.json())
      .then(data => {
        playlistData = data;
        playNext();
      })
      .catch(err => {
        debugDiv.innerText = "‚ùå Failed to load schedule.json";
        console.error(err);
      });
  </script>
</body>
</html>

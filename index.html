<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>OXO Scheduler</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
    }
    video, img#logo {
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      display: none;
    }
    #debug {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <video id="player" autoplay muted playsinline></video>
  <img id="logo" src="" alt="OXO Logo">
  <div id="debug"></div>

<script>
  const isMobile = /Mobi|Android/i.test(navigator.userAgent);
  const type = isMobile ? "Mobile" : "TV";

  const videoMap = {
    "Bucket": `https://nik978.github.io/OXO-Video-test/${type}/Bucket.mp4`,
    "Cosplay": `https://nik978.github.io/OXO-Video-test/${type}/Cosplay.mp4`,
    "Football": `https://nik978.github.io/OXO-Video-test/${type}/Football.mp4`,
    "Happy": `https://nik978.github.io/OXO-Video-test/${type}/Happy.mp4`,
    "Intro": `https://nik978.github.io/OXO-Video-test/${type}/Intro.mp4`,
    "Recruit": `https://nik978.github.io/OXO-Video-test/${type}/Recruit.mp4`
  };

  const playlistMap = {
    "Sun": {
      pre: ["Happy", "Football", "Happy", "Bucket"],
      post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"]
    },
    "Mon": { pre: ["Happy", "Football", "Happy", "Bucket"], post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"] },
    "Tue": { pre: ["Happy", "Football", "Happy", "Bucket"], post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"] },
    "Wed": { pre: ["Happy", "Football", "Happy", "Bucket"], post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"] },
    "Thu": { pre: ["Bucket", "Football", "Bucket", "Happy", "Bucket"], post: ["Intro", "Bucket", "Football", "Bucket", "Happy", "Bucket", "Cosplay", "Bucket", "Recruit"] },
    "Fri": { pre: ["Happy", "Football", "Happy", "Bucket"], post: ["Intro", "Football", "Bucket", "Happy", "Football", "Cosplay", "Football", "Recruit"] },
    "Sat": {
      pre: ["Happy", "Football", "Happy", "Football"],
      post: ["Football"]
    }
  };

  const video = document.getElementById("player");
  const logo = document.getElementById("logo");
  const debugDiv = document.getElementById("debug");

  const logoUrl = `https://nik978.github.io/OXO-Video-test/${type}/logo.png`;

  function isWithinActiveHours() {
    const now = new Date();
    const hour = now.getHours();
    return (hour >= 18 || hour < 5); // attivo tra le 18:00 e le 04:59
  }

  function getPlaylist() {
    const now = new Date();
    const day = now.toString().slice(0, 3);
    const minutes = now.getHours() * 60 + now.getMinutes();
    return (minutes >= 1110 && minutes < 1260) ? playlistMap[day].pre : playlistMap[day].post;
  }

  function updateDebug(fasciaLabel, videoName) {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const s = String(now.getSeconds()).padStart(2, '0');
    const d = now.getDay();
    debugDiv.innerHTML = `
      ðŸ•’ Time: ${h}:${m}:${s}<br>
      ðŸ“† Day: ${d} (Sun=0)<br>
      ðŸŽ¯ Fascia: ${fasciaLabel}<br>
      ðŸ“‚ Playlist: ${videoName || "-"}<br>
      ðŸ“º Versione: ${type}
    `;
  }

  let playlist = getPlaylist();
  let current = 0;

  function playNext() {
    const now = new Date();
    const totalMin = now.getHours() * 60 + now.getMinutes();
    const fasciaLabel = (totalMin >= 1110 && totalMin < 1260) ? "Fascia 1 (18:30â€“21:00)" : "Fascia 2 (21:00â€“04:00)";
    
    if (!isWithinActiveHours()) {
      video.style.display = "none";
      logo.style.display = "block";
      logo.src = logoUrl;
      updateDebug("INATTIVO", null);
      return;
    }

    const videoName = playlist[current % playlist.length];
    video.src = videoMap[videoName];
    video.style.display = "block";
    logo.style.display = "none";
    video.play();
    updateDebug(fasciaLabel, videoName);
    current++;
  }

  video.onended = playNext;

  setInterval(() => {
    const activeNow = isWithinActiveHours();
    if (activeNow && video.style.display === "none") {
      playlist = getPlaylist();
      current = 0;
      playNext();
    } else if (!activeNow && video.style.display === "block") {
      video.pause();
      logo.style.display = "block";
      logo.src = logoUrl;
      video.style.display = "none";
      updateDebug("INATTIVO", null);
    }
  }, 10000);

  playNext();
</script>
</body>
</html>
